<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    
    <title>JustAnOtherDevBlog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="JustAnOtherDevBlog : un nouveau blog de dev dont le but est de partager mes trouvailles. Mes sujets de prédilection : Java, Android, Git.">
    <meta property="og:title" content="JustAnOtherDevBlog" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="http://www.ybonnel.fr/img/JustAnOtherDevBlog.png" />
    <meta property="og:url" content="http://www.ybonnel.fr" />
    <meta property="og:description" content="JustAnOtherDevBlog : un nouveau blog de dev dont le but est de partager mes trouvailles. Mes sujets de prédilection : Java, Android, Git." />
    <meta property="og:locale" content="fr_FR" />
    <meta property="og:site_name" content="JustAnOtherDevBlog" />

    <!-- Le styles -->
    <link href="css/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <link href="css/asciidoctor.css" rel="stylesheet">
    <!-- link href="/css/bootstrap-theme.min.css" rel="stylesheet" -->
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">
    <link href='http://alexgorbatchev.com/pub/sh/3.0.83/styles/shCore.css' rel='stylesheet' type='text/css'/>
    <link href='http://alexgorbatchev.com/pub/sh/3.0.83/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body>
    <div id="wrap">

	
	      <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">JustAnOtherDevBlog</a>
          </div>
          <div class="collapse navbar-collapse" id="navbar-menu">
            <ul class="nav navbar-nav">
              <li><a href="https://github.com/ybonnel" target="github:ybonnel">Github</a></li>
              <li><a href="archive.html">Archives</a></li>
              <li><a href="feeds/posts/default.xml">Flux RSS</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
      <div class="container">


	<div class="page-header">
        <div class="row">
            <div class="col-xs-4 col-md-2"><img src="img/JustAnOtherDevBlog.png"></div>
            <div class="col-xs-12 col-md-8"><h1>JustAnOtherDevBlog</h1></div>
        </div>
	</div>

    <div class="row">

        <div class="col-sm-8">

            
                
                    <div  itemscope itemtype="http://schema.org/Blog">
                        <div itemprop="author" itemscope itemtype="http://schema.org/Person">
                            <meta itemprop="name" content="Yan Bonnel"/>
                        </div>
                        <meta itemprop="inLanguage" content="fr-FR"/>
                        <a itemprop="url" href="2014/07/completable-future.html">
                            <h1 itemprop="name">Back to the (Completable)Future</h1>
                        </a>
                        <p>
                            <time itemprop="datePublished"
                                  datetime="2014-07-23">
                                23 juillet 2014
                            </time>
                        </p>

                        <p>Tags :
                            <meta itemprop="keywords" content="java8,CompletableFuture"/>
                            <a href="tags/java8.html">java8</a>, <a href="tags/CompletableFuture.html">CompletableFuture</a>
                        </p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ybonnel.fr/2014/07/completable-future.html" data-text="Back to the (Completable)Future" data-via="ybonnel" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://www.ybonnel.fr/2014/07/completable-future.html"></div>

                        <div itemprop="blogPost">
                            <p><p>Je vais aujourd&rsquo;hui vous présenter les <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> de java 8.</p><p>Pour l&rsquo;exemple, nous allons réaliser un petit programme Java permettant de récupérer le titre le plus long parmi les articles du blog.<br/>Pour faire cela, nous allons récupérer la page <a href="http://www.ybonnel.fr/archive.html">archive</a> du blog, pour ensuite récupérer chaque lien d&rsquo;article et pour finir récupérer le titre des articles.</p><h1>Méthode naïve</h1><p>Commençons par la méthode naïve sans java8 :<br/><script src="https://gist.github.com/ybonnel/fd339f7df77ea325a52e.js"></script></p><p>Cette méthode a l&rsquo;intérêt d&rsquo;être très facilement compréhensible, par contre c&rsquo;est beaucoup trop séquentiel, il faudrait pouvoir exécuter les requêtes en parallel et non de manière séquentiel.</p><h1>Méthode à base de Future</h1><p>Nous allons maintenant exécuter les requêtes en parallel à l&rsquo;aide d&rsquo;un bon vieux ExecutorService :<br/><script src="https://gist.github.com/ybonnel/58d0d23a348573ab101d.js"></script></p><p>Cette méthode est beaucoup plus performante, mais un truc me gène :</p>
<pre><code>boolean allDone = false;
while (!allDone) {
    allDone = true;
    for (Future&lt;String&gt; result : results) {
        if (!result.isDone()) {
            allDone = false;
            break;
        }
    }
    Thread.sleep(50);
}
</code></pre><p>Avoir du code technique de ce type là en plein milieu, ça me plait pas trop.</p><p>UPDATE : Comme on me l&rsquo;a fait remarquer sur twitter, il est tout a fait possible de supprimer ce bloc, l&rsquo;attente étant gérer par le get.<br/>Cependant on ne voit plus de notion de &ldquo;tout les traitements terminés&rdquo;, ce qui dans un cas plus complexe peux être très utile.</p><h1>Méthode à base de CompletableFuture</h1><p>Nous allons maintenant transformer notre code pour utiliser les CompletableFuture de java8 :<br/><script src="https://gist.github.com/ybonnel/a077022e9a2b504f7446.js"></script></p><p>Personnellement je trouve ce code beaucoup plus lisible et sans (ou très peu de) code technique.</p><p>Quelques détails sur l&rsquo;API :</p>
<ul>
  <li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html#supplyAsync-java.util.function.Supplier-java.util.concurrent.Executor-">CompletableFuture.supplyAsync</a> : permet d&rsquo;exécuter un traitement en asynchrone, retourne le CompletableFuture correspondant.</li>
  <li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html#allOf-java.util.concurrent.CompletableFuture...-">CompletableFuture.allOf</a> : Permet de récupérer un CompletableFuture correspondant à la fin de tous les CompletableFuture passés en paramètres.</li>
  <li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html#thenApply-java.util.function.Function-">CompletableFuture.thenApply</a> : Execute un fonction une fois le CompletableFuture terminé. Cette fonction prend en paramètre l&rsquo;objet du CompletableFuture est renvoie un autre type.</li>
</ul><h1>Performances</h1><p>Voici les résultats des trois méthodes en terme de performances :</p>
<ul>
  <li>Méthode naïve : 2243ms</li>
  <li>Méthode à base de Future : 310ms</li>
  <li>Méthode à base de CompletableFuture : 230ms</li>
</ul><p>Pour les curieux, l&rsquo;ensemble de ma classe de test se trouve <a href="https://github.com/ybonnel/simpleweb4j-blog/blob/master/src/main/java/fr/ybonnel/blog/CompletableFutureTest.java">ici</a>.</p></p>
                        </div>
                        <p><a itemprop="discussionUrl" href="2014/07/completable-future.html#disqus_thread">Commentaires</a></p>

                    </div>
                

            
                
                    <div  itemscope itemtype="http://schema.org/Blog">
                        <div itemprop="author" itemscope itemtype="http://schema.org/Person">
                            <meta itemprop="name" content="Yan Bonnel"/>
                        </div>
                        <meta itemprop="inLanguage" content="fr-FR"/>
                        <a itemprop="url" href="2014/07/migrate-blogger-to-jbake.html">
                            <h1 itemprop="name">Migration de blogger à jbake</h1>
                        </a>
                        <p>
                            <time itemprop="datePublished"
                                  datetime="2014-07-02">
                                02 juillet 2014
                            </time>
                        </p>

                        <p>Tags :
                            <meta itemprop="keywords" content="blogger,jbake,github"/>
                            <a href="tags/blogger.html">blogger</a>, <a href="tags/jbake.html">jbake</a>, <a href="tags/github.html">github</a>
                        </p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ybonnel.fr/2014/07/migrate-blogger-to-jbake.html" data-text="Migration de blogger à jbake" data-via="ybonnel" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://www.ybonnel.fr/2014/07/migrate-blogger-to-jbake.html"></div>

                        <div itemprop="blogPost">
                            <p><p>Je vous en ai parlé la semaine dernière dans cet <a href="http://www.ybonnel.fr/2014/06/nouveau-blog.html">article</a>, je suis passé de blogger à jbake.</p><p>Le but de l&rsquo;article d&rsquo;aujourd&rsquo;hui sera de de donner un certain nombre d&rsquo;astuces autour de cette migration, plus quelques astuces sur jbake.</p><h1>Mise en place de Jbake</h1><p>Quand j&rsquo;ai commencé, je me suis basé sur le post de <a href="http://melix.github.io/blog/2014/02/hosting-jbake-github.html">Cédric</a>, mais j&rsquo;ai finalement décidé d&rsquo;abandonner gradle pour passer à mon vieil ami Maven.</p><p>La raison de ce changement est assez simple, je connais bien maven :)</p><p>J&rsquo;utilise le plugin <a href="https://github.com/jbake-org/jbake-maven-plugin">jbake-maven-plugin</a> sur lequel j&rsquo;ai fait deux <a href="https://github.com/jbake-org/jbake-maven-plugin/pulls">pull request</a>.<br/>La première pull request est pour qu&rsquo;il supporte jbake 2.3.0, la deuxième est pour qu&rsquo;il démarre un serveur livrereload sur le goal inline.</p><p>Si ces pull request sont mergées, ou si vous utilisez mon <a href="https://github.com/ybonnel/jbake-maven-plugin">fork</a>, les tests sont plutôt simples, il suffit de lancer :<br/><code>
mvn jbake:inline
</code><br/>Ouvrez ensuite <a href="http://localhost:8080">http://localhost:8080</a>, si vous activez livereload, dès que vous faites une modification, un refresh est déclenché, plutôt cool, non?</p><p>Concernant la publication sur github, j&rsquo;utilise le plugin de github : <a href="http://github.github.com/maven-plugins/site-plugin/">github-site-plugin</a>.</p><p>Si vous voulez voir les détails, vous pouvez regarder mon <a href="https://github.com/ybonnel/blog/blob/master/pom.xml">pom.xml</a>.</p><h1>Migration des articles</h1><p>Je ne voulais pas réécrire les anciens articles à la main, il a donc fallu que je trouve une procédure automatisée.</p><p>Je suis parti du flux rss de blogger, et pour chaque article je crée un fichier html dans mes sources jbake.<br/>Ma classe permettant celà est disponible <a href="https://github.com/ybonnel/blog/blob/master/src/main/java/BloggerToJbake.java">ici</a>.</p><h1>Migration des commentaires</h1><p>Pour la migration des commentaires, j&rsquo;ai été surpris, ça marche tout seul avec <a href="https://help.disqus.com/customer/portal/articles/1218656-importing-comments-from-blogger-to-disqus">disqus</a>.</p><h1>Quelques astuces sur les templates</h1><h2>Tags</h2><p>J&rsquo;avais commencé avec des templates freemarker, mais j&rsquo;ai pas réussi à faire ce que je voulais avec.<br/>Je voulais afficher la liste des tags avec entre parenthèses le nombre d&rsquo;articles possédant ce tag, le tout ordonné par nombre d&rsquo;articles décroissant.<br/>Je n&rsquo;ai trouvé aucune solution (sans code java) pour faire ça avec freemarker, alors qu&rsquo;en groovy c&rsquo;est relativement simple :<br/><script src="https://gist.github.com/ybonnel/4ec6f22377331d8a47e8.js"></script></p><h2>Sitemap des tags</h2><p>Voici le petit bout de code qui me permet de positionner la date de mise à jour des pages de type tag (correspondant au dernier article sur ce tag) :<br/><script src="https://gist.github.com/ybonnel/deec4ef0f1dcc0d07b68.js"></script></p><h1>Open-source</h1><p>Pour finir, si vous voyez un truc qui pourrait être amélioré sur le blog, il est maintenent <a href="https://github.com/ybonnel/blog/">open-source</a>.</p></p>
                        </div>
                        <p><a itemprop="discussionUrl" href="2014/07/migrate-blogger-to-jbake.html#disqus_thread">Commentaires</a></p>

                    </div>
                

            
                
                    <div  itemscope itemtype="http://schema.org/Blog">
                        <div itemprop="author" itemscope itemtype="http://schema.org/Person">
                            <meta itemprop="name" content="Yan Bonnel"/>
                        </div>
                        <meta itemprop="inLanguage" content="fr-FR"/>
                        <a itemprop="url" href="2014/06/nouveau-blog.html">
                            <h1 itemprop="name">Nouveau blog</h1>
                        </a>
                        <p>
                            <time itemprop="datePublished"
                                  datetime="2014-06-27">
                                27 juin 2014
                            </time>
                        </p>

                        <p>Tags :
                            <meta itemprop="keywords" content="blogger,jbake,github"/>
                            <a href="tags/blogger.html">blogger</a>, <a href="tags/jbake.html">jbake</a>, <a href="tags/github.html">github</a>
                        </p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ybonnel.fr/2014/06/nouveau-blog.html" data-text="Nouveau blog" data-via="ybonnel" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://www.ybonnel.fr/2014/06/nouveau-blog.html"></div>

                        <div itemprop="blogPost">
                            <p><p>Vous l&rsquo;avez surement déjà vu, mon blog a changé de tête&hellip;</p><p>Si vous voulez voir la différence, allez voir <a href="http://ybonnel.blogspot.fr/">l&rsquo;ancien blog</a>.</p><h1>Jbake</h1><p>J&rsquo;avais envie de tester <a href="http://jbake.org/">jbake</a> qui est un générateur de site statique, un peu à l&rsquo;image de jekyll mais en java.</p><p>J&rsquo;ai choisi jbake car j&rsquo;avais envie de pouvoir éditer et tester mon blog de manière offline, et il se trouve que jbake est à la mode actuellement.<br/>Autre avantge, l&rsquo;article que vous lisez est écrit en Markdown, en voici le <a href="https://github.com/ybonnel/blog/tree/master/src/jbake/content/2014/06/nouveau-blog.md">contenu</a>.</p><h1>Hébergement</h1><p>Vu que je passe sur une technologie avec des fichiers statiques, il est assez simple d&rsquo;héberger le résultat sur github.</p><p>Cédric explique assez bien la marche à suivre sur son <a href="http://melix.github.io/blog/2014/02/hosting-jbake-github.html">blog</a>.</p><h1>Vous en pensez quoi?</h1><p>Je ferai un article la semaine prochaine sur les détails de l&rsquo;implémentation et la migration depuis blogger.<br/>Je vous expliquerai également pouquoi j&rsquo;ai choisi les templates groovy</p><p>En attendant, n&rsquo;hésitez pas à me dire ce que vous en pensez.</p></p>
                        </div>
                        <p><a itemprop="discussionUrl" href="2014/06/nouveau-blog.html#disqus_thread">Commentaires</a></p>

                    </div>
                

            
                
                    <div  itemscope itemtype="http://schema.org/Blog">
                        <div itemprop="author" itemscope itemtype="http://schema.org/Person">
                            <meta itemprop="name" content="Yan Bonnel"/>
                        </div>
                        <meta itemprop="inLanguage" content="fr-FR"/>
                        <a itemprop="url" href="2014/06/websocket-et-comment-on-teste.html">
                            <h1 itemprop="name">WebSocket, et comment on teste?</h1>
                        </a>
                        <p>
                            <time itemprop="datePublished"
                                  datetime="2014-06-18">
                                18 juin 2014
                            </time>
                        </p>

                        <p>Tags :
                            <meta itemprop="keywords" content="Assertj,Awaitility,Java,Jetty,SimpleWeb4j,websocket"/>
                            <a href="tags/Assertj.html">Assertj</a>, <a href="tags/Awaitility.html">Awaitility</a>, <a href="tags/Java.html">Java</a>, <a href="tags/Jetty.html">Jetty</a>, <a href="tags/SimpleWeb4j.html">SimpleWeb4j</a>, <a href="tags/websocket.html">websocket</a>
                        </p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ybonnel.fr/2014/06/websocket-et-comment-on-teste.html" data-text="WebSocket, et comment on teste?" data-via="ybonnel" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://www.ybonnel.fr/2014/06/websocket-et-comment-on-teste.html"></div>

                        <div itemprop="blogPost">
                            <p><p>On a vu comment implémenter des websockets avec SimpleWeb4j dans un précédant <a href="http://www.ybonnel.fr/2014/06/websocket-et-simpleweb4j.html">article</a>, nous allons maintenant voir comment tester de manière automatisée la partie serveur websocket.</p><br/><h2>Librairies tierces</h2><p>Pour garder un code relativement propre, je vais utiliser trois librairies : <ul><li><a href="http://www.eclipse.org/jetty/documentation/current/jetty-websocket-client-api.html">websocket-client</a> : Client WebSocket en java.</li><li><a href="http://joel-costigliola.github.io/assertj/">assertj-core</a> : Librairie d'assertion "fluent"</li><li><a href="https://code.google.com/p/awaitility/">awaitility</a> : Librairie d'attente (pour gérer l'asynchrone)</li></ul></p><br/> <h2>Je veux faire quoi comme test?</h2><p>Je cherche à tester le code du billet précédant qui, pour rappel, était un système de chat. Le serveur de websocket reçoit donc des messages qu'il redistribue à tous les clients connectés.</p><p>Scénario de test : <ul><li>Ouverture d'une session 1.</li><li>Envoi d'un message par la session 1 (message 1).</li><li>Ouverture d'une session 2.</li><li>Envoi d'un message par la session 2 (message 2).</li><li>Envoi d'un message par la session 1 (message 3).</li><li>Fermeture de la session 1.</li><li>Envoi d'un message par la session 2 (message 4).</li><li>Fermeture de la session 2.</li>  </ul></p><p>Vérifications à faire : <ul><li>La session 1 a reçu 3 messages (les messages 1 à 3)</li><li>La session 2 a reçu 3 messages (les messages 2 à 4)</li></ul></p><br/> <h2>Code de test</h2><p>Assez parler, place au code. J'espère que les commentaires sont suffisants, si ce n'est pas le cas, n'hésitez pas à le dire j'en ajouterais.</p><script src="https://gist.github.com/ybonnel/fdc9348326e0667c52c7.js"></script>
</p>
                        </div>
                        <p><a itemprop="discussionUrl" href="2014/06/websocket-et-comment-on-teste.html#disqus_thread">Commentaires</a></p>

                    </div>
                

            
                
                    <div  itemscope itemtype="http://schema.org/Blog">
                        <div itemprop="author" itemscope itemtype="http://schema.org/Person">
                            <meta itemprop="name" content="Yan Bonnel"/>
                        </div>
                        <meta itemprop="inLanguage" content="fr-FR"/>
                        <a itemprop="url" href="2014/06/websocket-et-simpleweb4j.html">
                            <h1 itemprop="name">WebSocket et SimpleWeb4j</h1>
                        </a>
                        <p>
                            <time itemprop="datePublished"
                                  datetime="2014-06-11">
                                11 juin 2014
                            </time>
                        </p>

                        <p>Tags :
                            <meta itemprop="keywords" content="java8,javascript,SimpleWeb4j,websocket"/>
                            <a href="tags/java8.html">java8</a>, <a href="tags/javascript.html">javascript</a>, <a href="tags/SimpleWeb4j.html">SimpleWeb4j</a>, <a href="tags/websocket.html">websocket</a>
                        </p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ybonnel.fr/2014/06/websocket-et-simpleweb4j.html" data-text="WebSocket et SimpleWeb4j" data-via="ybonnel" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://www.ybonnel.fr/2014/06/websocket-et-simpleweb4j.html"></div>

                        <div itemprop="blogPost">
                            <p><p>Nous allons voir comment faire du websocket avec SimpleWeb4j.</p> <h2>WebSocket c'est quoi</h2><p><a href="http://fr.wikipedia.org/wiki/WebSocket">WebSocket</a> est un protocole permettant la communication de type push entre un browser et un serveur de manière bi-directionnelle.</p><br/> <h2>On fait quoi comme exemple?</h2><p>Comme je suis super original, on va partir sur un chat (le truc pour discuter, pas l'animal !), ça nous rappellera la grande époque de caramail :)</p><p>Pour mettre en place un chat, on a besoin d'un service côté serveur qui peut recevoir des messages en push depuis les clients, et quand il en reçoit un le redistribue à tous les clients.</p><br/> <h2>La partie serveur</h2><p>Nous allons commencer par créer notre objet métier représentant un message, celui-ci contient l'utilisateur, le texte et la date du message. Il servira pour les messages que l'on envoie aux clients (pour les flux client -> serveur, nous utiliserons une simple String).</p><script src="https://gist.github.com/ybonnel/387f265625b7f50b3fe1.js"></script> <p>Nous allons maintenant créer la route de la websocket avec la méthode <a href="https://simpleweb4j.ci.cloudbees.com/job/SimpleWeb4j-build/site/apidocs/fr/ybonnel/simpleweb4j/SimpleWeb4j.html#websocket-java.lang.String-fr.ybonnel.simpleweb4j.handlers.websocket.WebSocketAdapter-">SimpleWeb4j.websocket</a>, cette méthode prend en paramètre une String représentant l'url et un <a href="https://simpleweb4j.ci.cloudbees.com/job/SimpleWeb4j-build/site/apidocs/fr/ybonnel/simpleweb4j/handlers/websocket/WebSocketAdapter.html">WebSocketAdapter</a>. Un WebSocketAdapter et une factory qui contient une méthode prenant en paramètres les "RouteParameters" et qui construit un <a href="https://simpleweb4j.ci.cloudbees.com/job/SimpleWeb4j-build/site/apidocs/fr/ybonnel/simpleweb4j/handlers/websocket/WebSocketListener.html">WebSocketListenner</a>. On a donc le code suivant pour l'instant :</p><script src="https://gist.github.com/ybonnel/040e5d0fc44f185471f6.js"></script> <p>Voyons maintenant comment construire le "WebSocketListener", nous avons pour ça un builder. Nous souhaitons construire un listener en implémentant un comportement sur 3 événements : <ul><li><u>onConnect</u> : on ajoute la session dans un set pour connaître les sessions ouvertes.</li><li><u>onClose</u> : on supprime la session de notre set.</li><li><u>onMessage</u> : on envoi le message reçu à tout les clients.</li></ul>Voici donc le résultat final : </p><script src="https://gist.github.com/ybonnel/b4fe14c5f0cebeaccd90.js"></script><br/>  <h2>La partie cliente</h2><p>Pour la partie cliente, on a un objet javascript "WebSocket" qui prend l'url en paramètre du constructeur.</p><p>Il nous reste après à définir les callback "onmessage" et "onopen". Pour envoyer un message au serveur, il suffit d'utiliser la méthode WebSocket.send. Si vous voulez plus de détails, vous pouvez aller voir la page de <a href="https://developer.mozilla.org/fr-FR/docs/Web/API/WebSocket">mozilla</a>.</p><p>Voici donc la page html complète, comme d'habitude, j'utilise angular.js :) >/p><script src="https://gist.github.com/ybonnel/55b099746cbf87875110.js"></script><br/> <p>Alors, ça vous parait compliqué de faire du WebSocket?</p>
</p>
                        </div>
                        <p><a itemprop="discussionUrl" href="2014/06/websocket-et-simpleweb4j.html#disqus_thread">Commentaires</a></p>

                    </div>
                

            

            <hr />

            <p>Billets plus anciens disponibles sur la page <a href="archive.html">archive</a>.</p>

        </div>

        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
            <div class="sidebar-module sidebar-module-inset">
                <h4>Yan Bonnel</h4>
                <p>Geek. Technos de prédilections : Java, Android, Git.</p>
                <ul>
                    <li><a href="https://twitter.com/ybonnel">@ybonnel</a></li>
                    <li><a href="https://plus.google.com/110565525210888845228?rel=author">+yanbonnel</a></li>
                </ul>
            </div>

            <div class="sidebar-module">
                <a class="twitter-timeline"  href="https://twitter.com/ybonnel"  data-widget-id="482174196248608769">Tweets de @ybonnel</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
            </div>

            <div class="sidebar-module">
                <h4>Tags</h4>
                <ol class="list-unstyled" style="margin-left: 0px">
                    
                        <li><a href="tags/Java.html">Java</a> (15)</li>
                    
                        <li><a href="tags/java8.html">java8</a> (7)</li>
                    
                        <li><a href="tags/SimpleWeb4j.html">SimpleWeb4j</a> (6)</li>
                    
                        <li><a href="tags/CodeStory.html">CodeStory</a> (5)</li>
                    
                        <li><a href="tags/Devoxx.html">Devoxx</a> (5)</li>
                    
                        <li><a href="tags/EventSource.html">EventSource</a> (4)</li>
                    
                        <li><a href="tags/Server-Sent-Events.html">Server-Sent-Events</a> (4)</li>
                    
                        <li><a href="tags/SSE.html">SSE</a> (4)</li>
                    
                        <li><a href="tags/CSV.html">CSV</a> (3)</li>
                    
                        <li><a href="tags/Jetty.html">Jetty</a> (3)</li>
                    
                        <li><a href="tags/simple.html">simple</a> (3)</li>
                    
                        <li><a href="tags/Android.html">Android</a> (2)</li>
                    
                        <li><a href="tags/blogger.html">blogger</a> (2)</li>
                    
                        <li><a href="tags/github.html">github</a> (2)</li>
                    
                        <li><a href="tags/javascript.html">javascript</a> (2)</li>
                    
                        <li><a href="tags/jbake.html">jbake</a> (2)</li>
                    
                        <li><a href="tags/Logo.html">Logo</a> (2)</li>
                    
                        <li><a href="tags/Rennes.html">Rennes</a> (2)</li>
                    
                        <li><a href="tags/TDD.html">TDD</a> (2)</li>
                    
                        <li><a href="tags/websocket.html">websocket</a> (2)</li>
                    
                        <li><a href="tags/Assertj.html">Assertj</a> (1)</li>
                    
                        <li><a href="tags/auto-hébergement.html">auto-hébergement</a> (1)</li>
                    
                        <li><a href="tags/Awaitility.html">Awaitility</a> (1)</li>
                    
                        <li><a href="tags/cloud.html">cloud</a> (1)</li>
                    
                        <li><a href="tags/Comparatif.html">Comparatif</a> (1)</li>
                    
                        <li><a href="tags/CompletableFuture.html">CompletableFuture</a> (1)</li>
                    
                        <li><a href="tags/couchbase.html">couchbase</a> (1)</li>
                    
                        <li><a href="tags/CsvEngine.html">CsvEngine</a> (1)</li>
                    
                        <li><a href="tags/ExecutorService.html">ExecutorService</a> (1)</li>
                    
                        <li><a href="tags/git.html">git</a> (1)</li>
                    
                        <li><a href="tags/Google.html">Google</a> (1)</li>
                    
                        <li><a href="tags/Groovy.html">Groovy</a> (1)</li>
                    
                        <li><a href="tags/Jajascript.html">Jajascript</a> (1)</li>
                    
                        <li><a href="tags/JEE.html">JEE</a> (1)</li>
                    
                        <li><a href="tags/json.html">json</a> (1)</li>
                    
                        <li><a href="tags/NoMock.html">NoMock</a> (1)</li>
                    
                        <li><a href="tags/OneDay.html">OneDay</a> (1)</li>
                    
                        <li><a href="tags/OnePost.html">OnePost</a> (1)</li>
                    
                        <li><a href="tags/reactive.html">reactive</a> (1)</li>
                    
                        <li><a href="tags/REST.html">REST</a> (1)</li>
                    
                        <li><a href="tags/Scalaskel.html">Scalaskel</a> (1)</li>
                    
                 </ol>
            </div>
        </div>

    </div>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="text-muted credit">L'ensemble des posts de ce blog sont publiés sous licence <em>Creative Commons by-nc-sa</em>. <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a></p>
        <p class="text-muted credit">&copy; 2013 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v3.0.2</a> | Baked with <a href="http://jbake.org">JBake v2.3.0</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- script src="/js/jquery-1.10.2.min.js"></script -->
    <!-- script src="/js/bootstrap.min.js"></script -->
    <script src="js/run_prettify.js"></script>

    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shCore.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushCss.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushJava.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushJScript.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushSql.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushVb.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushXml.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushBash.js' type='text/javascript'></script>


    <script language='javascript'>
        SyntaxHighlighter.config.bloggerMode = true;
        SyntaxHighlighter.all();
    </script>


    <script type="text/javascript">
        window.___gcfg = {lang: 'fr'};

        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-28563381-1', 'www.ybonnel.fr');
      ga('send', 'pageview');

    </script>
    
  </body>
</html>

