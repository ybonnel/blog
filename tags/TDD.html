<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    
    <title>JustAnOtherDevBlog - TDD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="JustAnOtherDevBlog : TDD">
    <meta property="og:title" content="JustAnOtherDevBlog - TDD">
    <meta property="og:type" content="website">
    <meta property="og:image" content="http://www.ybonnel.fr/img/JustAnOtherDevBlog.png">
    <meta property="og:url" content="http://www.ybonnel.fr/tags/TDD.html">
    <meta property="og:description" content="JustAnOtherDevBlog : TDD">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="JustAnOtherDevBlog">

    <!-- Le styles -->
    <link href="../css/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <!-- link href="/css/bootstrap-theme.min.css" rel="stylesheet" -->
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">
    <link href='http://alexgorbatchev.com/pub/sh/3.0.83/styles/shCore.css' rel='stylesheet' type='text/css'/>
    <link href='http://alexgorbatchev.com/pub/sh/3.0.83/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
  </head>
  <body>
    <div id="wrap">

	
	      <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">JustAnOtherDevBlog</a>
          </div>
          <div class="collapse navbar-collapse" id="navbar-menu">
            <ul class="nav navbar-nav">
              <li><a href="https://github.com/ybonnel" target="github:ybonnel">Github</a></li>
              <li><a href="../archive.html">Archives</a></li>
              <li><a href="../feeds/posts/default.xml">Flux RSS</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
      <div class="container">


	<div class="page-header">
            <div class="row">
                <div class="col-xs-4 col-md-2"><img src="../img/JustAnOtherDevBlog.png"></div>
                <div class="col-xs-12 col-md-8"><h1>Tag: TDD</h1></div>
            </div>
	</div>

    <div class="row">

    <div class="col-sm-8">
        
            
                <a href="../2013/02/codestory-en-java-scalaskel-et-la.html"><h1>CodeStory en java : Scalaskel et la calculette</h1></a>
                <p>04 février 2013</p>

                <p>Tags :
                <a href="CodeStory.html">CodeStory</a>, <a href="Groovy.html">Groovy</a>, <a href="Java.html">Java</a>, <a href="Scalaskel.html">Scalaskel</a>, <a href="TDD.html">TDD</a>
                </p>

                <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ybonnel.fr/2013/02/codestory-en-java-scalaskel-et-la.html" data-text="CodeStory en java : Scalaskel et la calculette" data-via="ybonnel" data-lang="fr">Tweeter</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="g-plusone" data-size="medium" data-href="http://www.ybonnel.fr/2013/02/codestory-en-java-scalaskel-et-la.html"></div>

                <p><style type="text/css"> .code {  margin: 0 2em 0 2em;  padding: 1em;  background: rgb(230,244,231);  border: 1px solid rgb(89,180,89);  white-space: pre-wrap; /* CSS3 */  white-space: -moz-pre-wrap; /* Mozilla, post millennium */  white-space: -pre-wrap; /* Opera 4-6 */  white-space: -o-pre-wrap; /* Opera 7 */  word-wrap: break-word; /* Internet Explorer 5.5+ */ }  </style>  <p>Cet article fait suite à l'article <a href="http://www.ybonnel.fr/2013/02/ma-participation-codestory-en-java-intro.html">Ma participation à CodeStory en java : Intro</a>.<br/>Le but de cet article va être de vous parler de deux étapes du concours CodeStory : Scalaskel et la Calculette en vous présentant mon implémentation en Java. </p><br/> <h1>Scalaskel</h1><p>Voici l'énoncé tel que nous l'avons reçu par POST : </p> <div style="border:1px solid black"><blockquote><h2 id="lchoppe_de_monade_sur_scalaskel">L’échoppe de monade sur Scalaskel.</h2> <p>Sur la planète Scalaskel, une planète en marge de la galaxie, aux confins de l’univers, la monnaie se compte en cents, comme chez nous. 100 cents font un groDessimal. Le groDessimal est la monnaie standard utilisable partout sur toutes les planètes de l’univers connu. C’est un peu compliqué à manipuler, mais si on ne s’en sert pas y’a toujours des erreurs d’arrondis incroyables quand on les soustrait ou on les divise, c’est idiot, mais c’est comme ça. Sur Scalaskel, on utilise rarement des groDessimaux, on utilise des pièces plus petites : Le <strong>Foo</strong> vaut <strong>1 cent</strong>, le <strong>Bar</strong> vaut <strong>7 cents</strong>, le <strong>Qix</strong> vaut <strong>11 cents</strong> et le <strong>Baz</strong> vaut <strong>21 cents</strong>.</p> <p>Vous tenez une échoppe de monade et autres variables méta-syntaxiques sur Scalaskel. Pour faire face à l’afflux de touristes étrangers avec les poches remplies de groDessimaux vous avez besoin d’écrire un programme qui pour toute somme de 1 à 100 cents, vous donnera toutes les décompositions possibles en pièces de <strong>Foo</strong>, <strong>Bar</strong>, <strong>Qix</strong> ou <strong>Baz</strong>.</p> <p>Par exemple, 1 cent ne peut se décomposer qu’en une seule pièce <strong>Foo</strong>. Par contre 7 cents peuvent se décomposer soit en 7 pièces <strong>Foo</strong>, soit en 1 pièce <strong>Bar</strong>.</p> <h2 id="serveur_web_">Serveur Web :</h2> <p>Votre serveur doit répondre aux requêtes http GET de la forme <code>http://serveur/scalaskel/change/X</code>, <code>X</code> étant une valeur en cents de 1 à 100 cents.</p> <p>La réponse attendue est un json de la forme :</p></blockquote><pre class="code"><code>[{“foo”: w, “bar”: x, “qix”: y, “baz”: z}, …]</code></pre><blockquote><p>Exemples Pour <code>http://serveur/scalaskel/change/1</code> il faut répondre :</p></blockquote><pre class="code"><code>[ {“foo”: 1} ]</code></pre><blockquote><p>Pour <code>http://serveur/scalaskel/change/7</code> il faut répondre :</p></blockquote><pre class="code"><code>[ {“foo”: 7}, {“bar”: 1} ]</code></pre><blockquote><p>L’ordre des valeurs dans le tableau json, ainsi que le formatage n’a pas d’importance à partir du moment où c’est du json valide, il s’entend.</p> <p>Bon courage !</p></blockquote></div><p>Première chose à mettre en place, le test unitaire (et oui, même si on est pressé, le TDD c'est bien) : <pre class="brush:java"><br />import com.meterware.httpunit.WebConversation;<br />import com.meterware.httpunit.WebResponse;<br /><br />import static org.junit.Assert.assertEquals;<br /><br />public class ScalaskelTest extends WebServerTestUtil {<br /><br />    @Test<br />    public void should_answer_to_1cent() throws Exception {<br />        WebConversation wc = new WebConversation();<br />        WebResponse response = wc.getResponse(getURL() + "/scalaskel/change/1");<br />        assertEquals(200, response.getResponseCode());<br />        assertEquals("[{\"foo\":1}]", response.getText());<br />    }<br /><br />    @Test<br />    public void should_answer_to_7cent() throws Exception {<br />        WebConversation wc = new WebConversation();<br />        WebResponse response = wc.getResponse(getURL() + "/scalaskel/change/7");<br />        assertEquals(200, response.getResponseCode());<br />        assertEquals("[{\"foo\":7},{\"bar\":1}]", response.getText());<br />    }<br /><br />    @Test<br />    public void should_answer_to_11cent() throws Exception {<br />        WebConversation wc = new WebConversation();<br />        WebResponse response = wc.getResponse(getURL() + "/scalaskel/change/11");<br />        assertEquals(200, response.getResponseCode());<br />        assertEquals("[{\"foo\":11},{\"foo\":4,\"bar\":1},{\"qix\":1}]", response.getText());<br />    }<br /><br />    @Test<br />    public void should_answer_to_21cent() throws Exception {<br />        WebConversation wc = new WebConversation();<br />        WebResponse response = wc.getResponse(getURL() + "/scalaskel/change/21");<br />        assertEquals(200, response.getResponseCode());<br />        assertEquals("[{\"foo\":21},{\"foo\":14,\"bar\":1},{\"foo\":10,\"qix\":1},{\"foo\":7,\"bar\":2},{\"foo\":3,\"bar\":1,\"qix\":1},{\"bar\":3},{\"baz\":1}]", response.getText());<br />    }<br />}<br /></pre>Rien d'extraordinaire dans ce test, il contient seulement les cas basiques (en même temps, le calcul à la main est assez chiant comme ça). </p><p>Si vous avez lu l'article précédent, vous savez que mon code en l'état ne gère pas les requêtes par path du type "/scalaskel/change/1", commençons donc par là. Dans la même idée que le "QueryHandler" présenté dans l'article précendent, j'ai d'abord créé un "PathHandler" : <pre class="brush:java"><br />import fr.ybonnel.codestory.WebServerResponse;<br />import javax.servlet.http.HttpServletRequest;<br /><br />public abstract class AbstractPathHandler {<br />    public abstract WebServerResponse getResponse(HttpServletRequest request, String payLoad, String... params) throws Exception;<br />}<br /></pre>La "request" sert à récupérer deux choses : la méthode (GET/POST) et le path. Le payload est utile pour les énoncés et jajascript (données envoyées en POST). Et pour finir les params sont le résultat de l'application d'un pattern que nous verrons ensuite. </p><p>Tout comme pour les Query, j'ai mis en place un enum relativement proche, mis à part qu'il n'a pas de méthodes abstraites. Cet enum gère de manière générique le routage avec la méthode et un pattern. Voici le code complet de cet enum : <pre class="brush:java"><br />import fr.ybonnel.codestory.WebServerResponse;<br />import javax.servlet.http.HttpServletRequest;<br />import javax.servlet.http.HttpServletResponse;<br />import java.util.regex.Matcher;<br />import java.util.regex.Pattern;<br /><br />public enum PathType {<br /><br />    INSERT_ENONCE(new InsertEnonceHandler(), "/enonce/(\\d+)", "POST"),<br />    GET_ENONCES(new GetEnoncesHandler(), "/enonce(/)*", "GET"),<br />    SCALASKEL_CHANGES(new ChangeScalaskelHandler(), "/scalaskel/change/(\\d+)", "GET"),<br />    JAJASCRIPT(new OptimizeJajascriptHandler(), "/jajascript/optimize.*", "POST");<br /><br />    private AbstractPathHandler handler;<br /><br />    private Pattern pathPattern;<br />    private String method;<br /><br />    PathType(AbstractPathHandler handler, String pathPattern, String method) {<br />        this.handler = handler;<br />        this.pathPattern = Pattern.compile(pathPattern);<br />        this.method = method;<br />    }<br /><br /><br />    public Matcher isThisPath(String method, String path) {<br />        if (this.method.equals(method)) {<br />            return pathPattern.matcher(path);<br />        } else {<br />            return null;<br />        }<br />    }<br /><br />    public static WebServerResponse getResponse(HttpServletRequest request, String payLoad) throws Exception {<br />        for (PathType onePath : values()) {<br />            Matcher isThisPath = onePath.isThisPath(request.getMethod(), request.getPathInfo());<br />            if (isThisPath != null && isThisPath.matches()) {<br />                return onePath.handler.getResponse(request, payLoad, extractParameters(isThisPath));<br />            }<br />        }<br />        return new WebServerResponse(HttpServletResponse.SC_NOT_FOUND, "This path is unknown");<br />    }<br /><br />    private static String[] extractParameters(Matcher thisPath) {<br />        String[] params = new String[thisPath.groupCount()];<br />        for (int groupIndex = 1; groupIndex &lt;= thisPath.groupCount(); groupIndex++) {<br />            params[groupIndex - 1] = thisPath.group(groupIndex);<br />        }<br />        return params;<br />    }<br />}<br /></pre></p><p>Maintenant que nous avons vu la tuyauterie, passons à l'algo de Scalaskel en lui-même. Au niveau modèle, j'ai deux classes, une représentant une solution (Change), et un enum représentant les pièces : <pre class="brush:java"><br />import com.fasterxml.jackson.annotation.JsonProperty;<br /><br />public class Change {<br />    @JsonProperty<br />    private Integer foo;<br />    @JsonProperty<br />    private Integer bar;<br />    @JsonProperty<br />    private Integer qix;<br />    @JsonProperty<br />    private Integer baz;<br /><br />    public Change(Change change) {<br />        if (change != null) {<br />            foo = change.foo;<br />            bar = change.bar;<br />            qix = change.qix;<br />            baz = change.baz;<br />        }<br />    }<br /><br />    public void pay(Coin coin) {<br />        switch (coin) {<br />            case FOO:<br />                foo = foo == null ? 1 : foo + 1;<br />                break;<br />            case BAR:<br />                bar = bar == null ? 1 : bar + 1;<br />                break;<br />            case QIX:<br />                qix = qix == null ? 1 : qix + 1;<br />                break;<br />            case BAZ:<br />                baz = baz == null ? 1 : baz + 1;<br />                break;<br />        }<br />    }<br />}<br /></pre> <pre class="brush:java"><br />import java.util.List;<br /><br />import static com.google.common.collect.Lists.newArrayList;<br /><br />public enum Coin {<br />    FOO(1),<br />    BAR(7),<br />    QIX(11),<br />    BAZ(21);<br /><br />    private int value;<br /><br />    Coin(int value) {<br />        this.value = value;<br />    }<br /><br />    public int getValue() {<br />        return value;<br />    }<br /><br />    public boolean canPay(int cents) {<br />        return cents >= value;<br />    }<br /><br />    private static class ListHolder {<br />        private static final List&lt;Coin&gt; valuesAsLists = newArrayList(values());<br />    }<br /><br />    public static List&lt;Coin&gt; valuesAsLists() {<br />        return ListHolder.valuesAsLists;<br />    }<br />}<br /></pre>La classe Change contient des annotations pour la sérialisation Json avec Jackson, elle contient également un constructeur par copie servant dans l'algo, ainsi qu'une méthode pay, permettant d'ajouter une pièce à une solution. Quand à la classe Coin, elle contient une méthode "canPay" permettant de savoir si on peut ajouter la pièce pour un nombre de cents restant. Les listes sont là pour pouvoir utiliser la méthode Collections2.filter de Guava. </p><p>Et pour finir, voici la classe principale : le service permettant de faire le calcul. <pre class="brush:java"><br />import com.google.common.base.Predicate;<br />import com.google.common.collect.Collections2;<br />import com.google.common.collect.Lists;<br /><br />import java.util.List;<br /><br />public enum ScalaskelChangeService {<br />    INSTANCE;<br /><br />    public static ScalaskelChangeService getInstance() {<br />        return INSTANCE;<br />    }<br /><br />    public List&lt;Change&gt; calculateChanges(int cents) {<br />        return completeChanges(cents, null, null);<br />    }<br /><br />    private List&lt;Change&gt; completeChanges(int cents, Change currentChange, Coin lastCoin) {<br />        // Stop condition of recursivity<br />        if (cents == 0) {<br />            return Lists.newArrayList(currentChange);<br />        }<br />        List&lt;Change&gt; changes = Lists.newArrayList();<br />        for (Coin coin : Collections2.filter(<br />                Coin.valuesAsLists(),<br />                new FilterCoins(lastCoin, cents))) {<br />            Change change = new Change(currentChange);<br />            change.pay(coin);<br />            changes.addAll(completeChanges(cents - coin.getValue(), change, coin));<br />        }<br />        return changes;<br />    }<br /><br />    /**<br />     * Filter coins with this rule :<br />     * coin is keeped only if :<br />     * &lt;ul&gt;<br />     * &lt;li&gt;its value is bigger or equals thant lastCoin&lt;/li&gt;<br />     * &lt;li&gt;we can pay with the coin.&lt;/li&gt;<br />     * &lt;/ul&gt;<br />     */<br />    private static class FilterCoins implements Predicate<Coin> {<br /><br />        private int minValue;<br />        private int centsToPay;<br /><br />        private FilterCoins(Coin lastCoin, int centsToPay) {<br />            minValue = lastCoin == null ? 0 : lastCoin.getValue();<br />            this.centsToPay = centsToPay;<br />        }<br /><br />        @Override<br />        public boolean apply(Coin input) {<br />            return minValue <= input.getValue() && input.canPay(centsToPay);<br />        }<br />    }<br />}<br /></pre>Cette classe est un enum pour le côté singleton. La classe FilterCoins permet de filtrer les pièces utilisables en fonction de la dernière pièce utilisée ainsi que le nombre de cents restant à payer. Pour l'algo, il s'agit d'un algo récursif relativement bourrin. Il est sûr que si les performances avaient été un critère, j'aurais sûrement modifié l'algo. J'espère que mon code est suffisamment clair pour ne pas avoir à l'expliquer d'avantage. </p><p>La dernière partie que nous n'avons pas vu est le "PathHandler" permettant de lier le service au WebServer : <pre class="brush:java"><br />import com.fasterxml.jackson.annotation.JsonInclude;<br />import com.fasterxml.jackson.core.JsonProcessingException;<br />import com.fasterxml.jackson.databind.ObjectMapper;<br />import fr.ybonnel.codestory.WebServerResponse;<br />import fr.ybonnel.codestory.path.scalaskel.Change;<br />import fr.ybonnel.codestory.path.scalaskel.ScalaskelChangeService;<br /><br />import javax.servlet.http.HttpServletRequest;<br />import javax.servlet.http.HttpServletResponse;<br />import java.util.List;<br /><br />public class ChangeScalaskelHandler extends AbstractPathHandler {<br /><br />    private ObjectMapper objectMapper = new ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);<br /><br />    private boolean wrongParams(int centsToPay) {<br />        return centsToPay &lt;= 0 || centsToPay &gt; 100;<br />    }<br /><br />    @Override<br />    public WebServerResponse getResponse(HttpServletRequest request, String payLoad, String... params) throws JsonProcessingException {<br />        int centsToPay = Integer.parseInt(params[0]);<br />        if (wrongParams(centsToPay)) {<br />            return new WebServerResponse(HttpServletResponse.SC_FORBIDDEN, "Wrong parameters");<br />        }<br /><br />        List&lt;Change&gt; changes = ScalaskelChangeService.getInstance().calculateChanges(centsToPay);<br />        return new WebServerResponse(HttpServletResponse.SC_OK, objectMapper.writeValueAsString(changes));<br />    }<br />}<br /></pre>Dans cette classe, vous pouvez voir une petite protection afin d'éviter de faire tomber le serveur en demandant le change de 1.000.000 de cents. On peut également y voir la sérialisation Json avec Jackson, mais rien de sorcier non plus. </p><br/> <h1>La calculette</h1><p>Pour cet exercice, pas d'énoncé, la première requête reçue fut : "/?q=1+1" à laquelle on se doute qu'il faut répondre "2". Je ne vais pas vous détailler toutes les étapes par lesquelles je suis passé pour arriver au bout. Voici la liste des requêtes reçues (dans l'ordre) : <ul><li>1+1</li><li>2+2</li><li>3+3</li><li>4+4</li><li>5+5</li><li>6+6</li><li>7+7</li><li>8+8</li><li>9+9</li><li>1*1</li><li>2*2</li><li>3*3</li><li>4*4</li><li>5*5</li><li>6*6</li><li>7*7</li><li>8*8</li><li>9*9</li><li>1+2*2</li><li>(1+2)*2</li><li>(1+2+3+4+5+6+7+8+9+10)*2</li><li>(1+2)/2</li><li>((1+2)+3+4+(5+6+7)+(8+9+10)*3)/2*5</li><li>1,5*4</li><li>((1,1+2)+3,14+4+(5+6+7)+(8+9+10)*4267387833344334647677634)/2*553344300034334349999000</li><li>((1,1+2)+3,14+4+(5+6+7)+(8+9+10)*4267387833344334647677634)/2*553344300034334349999000/31878018903828899277492024491376690701584023926880</li><li>(-1)+(1)</li><li>1,0000000000000000000000000000000000000000000000001*1,0000000000000000000000000000000000000000000000001</li></ul>Cette liste vous permet sans doute de voir par quelles étapes je suis passé : <ul><li>Gestion des sommes</li><li>Gestion des multiplication</li><li>Gestion des priorités</li><li>Gestion des parenthèses</li><li>Gestion des divisions</li><li>Gestion des décimaux</li><li>Gestion des grands nombres</li><li>Gestion des nombres négatifs</li><li>Gestion des nombres de décimales élevés</li></ul>Pour la première version de mon code, j'ai tout fait à la main à grand coup de Pattern, voici le résultat final : <pre class="brush:java"><br />import com.google.common.base.Throwables;<br />import fr.ybonnel.codestory.query.calculate.Operator;<br />import fr.ybonnel.codestory.query.calculate.SearchParanthesis;<br /><br />import java.math.BigDecimal;<br />import java.math.RoundingMode;<br />import java.text.DecimalFormat;<br />import java.text.DecimalFormatSymbols;<br />import java.text.NumberFormat;<br />import java.text.ParseException;<br />import java.util.ArrayList;<br />import java.util.List;<br />import java.util.Locale;<br />import java.util.regex.Matcher;<br />import java.util.regex.Pattern;<br /><br />public class CalculateQueryHandler extends AbstractQueryHandler {<br /><br />    private static final String NOMBRE = "\\-?\\d+\\.?\\d*";<br />    private static final String PATTERN_DIVIDE = "(" + NOMBRE + ")/(" + NOMBRE + ")";<br />    private static final String PATTERN_MULTIPLY = "(" + NOMBRE + ")\\*(" + NOMBRE + ")";<br />    private static final String PATTERN_ADD = "(" + NOMBRE + ")\\+(" + NOMBRE + ")";<br /><br />    // operators list by priority.<br />    private List<Operator> operators = new ArrayList<Operator>() {{<br />        // operator divide.<br />        add(new Operator(PATTERN_DIVIDE) {<br />            @Override<br />            public BigDecimal operate(BigDecimal a, BigDecimal b) {<br />                try {<br />                    return a.divide(b);<br />                } catch (ArithmeticException exception) {<br />                    return a.divide(b, 1000, RoundingMode.HALF_UP);<br />                }<br />            }<br />        });<br />        // Operator Multiply.<br />        add(new Operator(PATTERN_MULTIPLY) {<br />            @Override<br />            public BigDecimal operate(BigDecimal a, BigDecimal b) {<br />                return a.multiply(b);<br />            }<br />        });<br />        // Operator Add.<br />        add(new Operator(PATTERN_ADD) {<br />            @Override<br />            public BigDecimal operate(BigDecimal a, BigDecimal b) {<br />                return a.add(b);<br />            }<br />        });<br />    }};<br /><br />    private Pattern patternParenthesis = Pattern.compile("\\((.*)\\)");<br />    private NumberFormat format = new DecimalFormat("#0.#", new DecimalFormatSymbols(Locale.FRANCE));<br /><br />    public CalculateQueryHandler() {<br />        format.setMaximumFractionDigits(500);<br />    }<br /><br />    @Override<br />    public String getResponse(String query) {<br />        String result = null;<br />        try {<br />            result = calculateWithParenthesis(query.replace(' ', '+').replace(',', '.'));<br />        } catch (ParseException e) {<br />            Throwables.propagate(e);<br />        }<br /><br />        try {<br />            BigDecimal retour = new BigDecimal(result);<br />            return format.format(retour);<br />        } catch (NumberFormatException numberFormatException) {<br />            numberFormatException.printStackTrace();<br />            return null;<br />        }<br />    }<br /><br />    private String calculateWithParenthesis(String calculateQuery) throws ParseException {<br />        Matcher matcherParenthsis = patternParenthesis.matcher(calculateQuery);<br /><br />        while (matcherParenthsis.find()) {<br />            SearchParanthesis searchParanthesis = new SearchParanthesis(calculateQuery).invoke();<br />            int start = searchParanthesis.getStart();<br />            int end = searchParanthesis.getEnd();<br /><br />            // Calculate the content of parenthesis.<br />            String queryBetweenParenthesis = calculateQuery.substring(start + 1, end - 1);<br />            String result = calculateWithoutParenthesis(queryBetweenParenthesis);<br /><br />            // Replace the parenthesis group with result.<br />            calculateQuery = calculateQuery.substring(0, start) + result + calculateQuery.substring(end);<br />            matcherParenthsis = patternParenthesis.matcher(calculateQuery);<br />        }<br /><br />        calculateQuery = calculateWithoutParenthesis(calculateQuery);<br />        return calculateQuery;<br />    }<br /><br />    private String calculateWithoutParenthesis(String calculateQuery) throws ParseException {<br /><br />        for (Operator operator : operators) {<br />            Matcher matcher = operator.matcher(calculateQuery);<br /><br />            while (matcher.find()) {<br />                BigDecimal a = new BigDecimal(matcher.group(1));<br />                BigDecimal b = new BigDecimal(matcher.group(2));<br />                BigDecimal result = operator.operate(a, b);<br /><br />                // Replace sur operation in string by result.<br />                calculateQuery = calculateQuery.substring(0, matcher.start()) + result.toString() + calculateQuery.substring(matcher.end());<br /><br />                matcher = operator.matcher(calculateQuery);<br />            }<br />        }<br /><br />        return calculateQuery;<br />    }<br />}<br /></pre>Je vous l'accorde, le code est relativement complexe, mais je suis assez fier d'avoir pondu une calculette à la main. </p><p>Devant tout ce code, j'ai décidé de simplifier tout ça grâce à groovy, vous allez voir le code est grandement simplifié : <pre class="brush:java"><br />import groovy.lang.GroovyShell;<br />import java.text.DecimalFormat;<br />import java.text.DecimalFormatSymbols;<br />import java.text.NumberFormat;<br />import java.util.Locale;<br /><br />public class CalculateQueryHandler extends AbstractQueryHandler {<br />    private NumberFormat format = new DecimalFormat("#0.#", new DecimalFormatSymbols(Locale.FRANCE));<br />    private GroovyShell shell = new GroovyShell();<br /><br />    public CalculateQueryHandler() {<br />        format.setMaximumFractionDigits(500);<br />    }<br /><br />    @Override<br />    public String getResponse(String query) {<br />        Object object = shell.evaluate("return " + query.replace(' ', '+').replace(',', '.'));<br />        return formatGroovyReturn(object);<br />    }<br /><br />    private String formatGroovyReturn(Object object) {<br />        try {<br />            return format.format(object);<br />        } catch (NumberFormatException numberFormatException) {<br />            numberFormatException.printStackTrace();<br />            return null;<br />        }<br />    }<br />}<br /></pre>Et voilà, merci groovy, finalement pas besoin de réinventer la roue... </p><br/><br/><br/><p>Cet article est le deuxième d'une série de trois articles dont le dernier est sans doute le plus intéressant : <a href="http://www.ybonnel.fr/2013/02/code-story-en-java-jajascript-et-les.html">Jajascript et les performance</a>. Afin de vous donner un avant-goût, vous pouvez regarder l'article sur le blog Code Story : <a href="http://code-story.net/2013/02/02/jajascript.html">Location d’astronef sur Jajascript</a>. </p>  
</p>
                <p><a href="2013/02/codestory-en-java-scalaskel-et-la.html#disqus_thread">Commentaires</a></p>
            

        
            
                <a href="../2013/02/ma-participation-codestory-en-java-intro.html"><h1>Ma participation à CodeStory en java : Intro</h1></a>
                <p>03 février 2013</p>

                <p>Tags :
                <a href="CodeStory.html">CodeStory</a>, <a href="Java.html">Java</a>, <a href="TDD.html">TDD</a>
                </p>

                <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ybonnel.fr/2013/02/ma-participation-codestory-en-java-intro.html" data-text="Ma participation à CodeStory en java : Intro" data-via="ybonnel" data-lang="fr">Tweeter</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="g-plusone" data-size="medium" data-href="http://www.ybonnel.fr/2013/02/ma-participation-codestory-en-java-intro.html"></div>

                <p><p>La première étape du concours <a href="http://www.code-story.net/">Code Story</a> vient de se terminer, je vais donc tenter de faire un résumé de ma participation à ce concours. Pour les curieux, le classement est disponible <a href="https://www.blogger.com/status.code-story.net">ici</a>.<br />Etant sans doute un peu malade, j'ai participé à ce concours 3 fois : en Java, en Ceylon et en Scala. Mon inscription principale avec le code le plus soigné et complet reste celle en Java. Je vais donc dans un premier temps vous faire un retour sur la partie Java. L'ensemble du code source de ma participation en java est disponible sur <a href="https://github.com/ybonnel/CodeStory">github</a><br />Les étapes de l'application étant nombreuses, je vais découper ça en plusieurs articles  : <ul><li>Serveur Http et TDD (déjà présenté dans l'article suivant : <a href="http://www.ybonnel.fr/2013/01/marre-du-cloud-et-du-jee-vive-lauto.html">Marre du cloud et du JEE -&gt; vive l'auto-hébergement et les main.</a>)</li><li>Les logs et répondre à des questions fixes (dans le présent article)</li><li><a href="http://www.ybonnel.fr/2013/02/codestory-en-java-scalaskel-et-la.html">Scalaskel et la calculette</a></li><li><a href="http://www.ybonnel.fr/2013/02/code-story-en-java-jajascript-et-les.html">Jajascript et les performances</a></li></ul></p> <h1>Principes du concours</h1><p>Afin de comprendre les choix que j'ai faits au niveau du code, il est important de connaître les principes de ce concours. Au départ, on s'inscrit en donnant juste une URL publique (ex : http://serveur.mondomain.fr:8080). Le seul truc que l'on sait avant de commencer, c'est qu'on va recevoir une requête GET sur http://serveur.mondomain.fr:8080/?q=Quelle+est+ton+adresse+email à laquelle il faut répondre avec l'adresse email, pour les curieux, le règlement est disponible <a href="http://code-story.net/2013/01/04/concours-2013.html">ici</a>. On se doute également dès le départ qu'on recevra d'autres requêtes HTTP auxquelles il faudra répondre (d'où le besoin de logs).</p><br/> <h1>Répondre à des questions fixes</h1><p>Les premières requêtes n'étaient pas très compliquées, il s'agissait simplement de questions avec une réponse fixe attendue. Pour information, voici la liste des questions reçues : <ul><li>?q=Quelle est ton adresse email</li><li>?q=Es tu abonne a la mailing list(OUI/NON)</li><li>?q=Es tu heureux de participer(OUI/NON)</li><li>?q=Es tu pret a recevoir une enonce au format markdown par http post(OUI/NON)</li><li>?q=Est ce que tu reponds toujours oui(OUI/NON)</li><li>?q=As tu bien recu le premier enonce(OUI/NON)</li><li>?q=As tu bien recu le second enonce(OUI/NON)</li><li>?q=As tu passe une bonne nuit malgre les bugs de l etape precedente(PAS_TOP/BOF/QUELS_BUGS)</li><li>?q=As tu copie le code de ndeloof(OUI/NON/JE_SUIS_NICOLAS)</li><li>?q=Souhaites-tu-participer-a-la-suite-de-Code-Story(OUI/NON)</li></ul>Afin de pouvoir rapidement faire évoluer l'application pour ajouter la gestion de futures questions, voici comment j'ai développé.</p><p>Première étape le test JUnit (et oui j'ai fait du TDD), voici donc l'exemple du test pour la troisième question : <pre class="brush:java">@Test<br />public void should_answer_to_participate() throws Exception {<br />    WebConversation wc = new WebConversation();<br />    WebResponse response = wc.getResponse(getURL() + "/?q=Es tu heureux de participer(OUI/NON)");<br />    assertEquals(200, response.getResponseCode());<br />    assertEquals("Response must be 'OUI'", "OUI", response.getText());<br />}<br /></pre>Le test est donc très simple, rapide à écrire, et se met à la place du robot pour effectuer le test (la librairie utilisée est HttpUnit).</p><p>Voyons maintenant comment j'ai codé le serveur. A travers les premières questions, on se rend compte qu'une partie des requêtes reçues va l'être avec le paramètre "q", j'ai donc décidé de créer la notion de QueryHandler chargée de répondre aux requêtes reçues avec ce paramètre. Voici la classe abstraite associée : <pre class="brush:java">public abstract class AbstractQueryHandler {<br />    public abstract String getResponse(String query);<br />}<br /></pre></p><p>La tuyauterie pour appeler le handler (et le bon) et relativement simple. Côté handler HTTP, c'est juste la récupération du paramètre et l'appel d'une méthode de la classe chargée d'appeler le bon QueryHandler : <pre class="brush:java">String query = request.getParameter(QUERY_PARAMETER);<br />if (query != null) {<br />    response = QueryType.getResponse(query);<br />}<br /></pre>La variable "response" contient le texte à renvoyer, mais également le status HTTP à utiliser. La classe "QueryType" est en fait un "enum", prenant en paramètre de constructeur le handler à utiliser, et ayant une méthode abstraite "isThisQueryType" prenant en paramètre la "query" et renvoyant un boolean permettant de savoir si c'est lui qui est responsable de cette "query". Et pour finir, cet enum contient une méthode statique chargée d'appeler le bon QueryHandler en fonction de la query. Voici la classe avec l'exemple de question vu plus haut : <pre class="brush:java">import fr.ybonnel.codestory.WebServerResponse;<br />import javax.servlet.http.HttpServletResponse;<br /><br />public enum QueryType {<br /><br />    PARTICIAPATE(new FixResponseQueryHandler("OUI")) {<br />        @Override protected boolean isThisQueryType(String query) {<br />            return query.equals("Es tu heureux de participer(OUI/NON)");<br />        }<br />    };<br /><br />    private AbstractQueryHandler queryHandler;<br /><br />    QueryType(AbstractQueryHandler queryHandler) {<br />        this.queryHandler = queryHandler;<br />    }<br /><br />    protected abstract boolean isThisQueryType(String query);<br /><br />    public static WebServerResponse getResponse(String query) {<br />        for (QueryType oneQuestion : values()) {<br />            if (oneQuestion.isThisQueryType(query)) {<br />                return new WebServerResponse(HttpServletResponse.SC_OK, oneQuestion.queryHandler.getResponse(query));<br />            }<br />        }<br />        return new WebServerResponse(HttpServletResponse.SC_NOT_FOUND, "Query " + query + " is unknown");<br />    }<br />}<br /></pre>Vous pouvez donc voir dans cette enum l'apparition de la classe FixResponseQueryHandler, cette classe est très simple, son rôle est simplement de renvoyer une réponse fixe, la voici : <pre class="brush:java">public class FixResponseQueryHandler extends AbstractQueryHandler {<br /><br />    private String response;<br />    public FixResponseQueryHandler(String response) {<br />        this.response = response;<br />    }<br /><br />    @Override public String getResponse(String query) {<br />        return response;<br />    }<br />}<br /></pre></p><p>Voici donc tous les éléments que j'ai mis en place pour les questions avec réponses fixes. A posteriori, on aurait pu mettre en place une simple Map (c'est ce que j'ai fait en Ceylon et en Scala), mais c'est le problème de coder au fur et à mesure que les questions arrivent, on ne sait pas trop ce qui va arriver ensuite... J'aurais évidement pu refactorer tout ça (les tests unitaires me permettant d'être sûr de ne pas tout casser), mais j'ai eu la flemme, d'autant que ce n'est pas la partie la plus intéressante, les énoncés suivants étant bien plus sympas. </p><br/> <h1>Les logs</h1><p>Un élément important de ce concours, c'est que nous ne recevions aucune consigne par mail, twitter ou pigeon voyageur. Le seul mode d'interaction était l'envoi d'une requête HTTP par le robot qui renvoyait la requête tant qu'on ne répondait pas correctement. Afin de pouvoir être réactif aux nouvelles requêtes en toute circonstance, je me suis ajouté un système de logs en base de donnée avec possibilité de les récupérer par un appel http (ce qui me permettait de la faire même depuis mon téléphone). Je ne vais pas vous détailler comment j'ai mis en place ce système, mais plutôt comment j'ai mis en place la BDD tout en gardant un système simple et rapide à tester. </p> <h2>Mise en place de la BDD</h2><p>Comme vous le savez, je n'ai pas de stack compliquée pour cette application, pour mettre en place une BDD simple, je suis parti sur un h2 embarqué. Première étape ajout de la dépendance au pom.xml : <pre class="bursh:xml"><br />&lt;dependency&gt;<br />    &lt;groupId&gt;com.h2database&lt;/groupId&gt;<br />    &lt;artifactId&gt;h2&lt;/artifactId&gt;<br />    &lt;version&gt;1.3.170&lt;/version&gt;<br />&lt;/dependency&gt;<br /></pre></p><p>Sur l'utilisation de celle-ci, rien d'extra-ordinaire, je suis parti sur du jdbc à la main. Ça peux paraître archaïque, mais pour gérer 2 pauvres tables (une pour les logs et une pour les énoncés), pas besoin de sortir l'artillerie lourde. Pour les curieux, voici la classe centrale pour gérer la base : <pre class="brush:java"><br />import com.google.common.base.Throwables;<br />import org.h2.jdbcx.JdbcDataSource;<br /><br />import java.sql.Connection;<br />import java.sql.DriverManager;<br />import java.sql.SQLException;<br />import java.sql.Statement;<br /><br />public enum DatabaseManager {<br /><br />    INSTANCE;<br /><br />    public static final String TYPE_Q = "Q";<br />    public static final String DB_DRIVER = "org.h2.Driver";<br />    public static final String DB_USER = "sa";<br /><br />    private JdbcDataSource ds;<br /><br />    DatabaseManager() {<br />        try {<br />            Class.forName(DB_DRIVER);<br /><br />            boolean databaseExists = doesDatabaseExists();<br /><br />            ds = new JdbcDataSource();<br />            ds.setURL(DatabaseUtil.getUrl());<br />            ds.setUser(DB_USER);<br />            ds.setPassword(DB_USER);<br /><br />            if (!databaseExists) {<br />                createDatabase();<br />            }<br />        } catch (Exception exception) {<br />            Throwables.propagate(exception);<br />        }<br />    }<br /><br />    private static boolean doesDatabaseExists() {<br />        boolean databaseExists = false;<br />        try {<br />            String url = DatabaseUtil.getUrl() + ";IFEXISTS=TRUE";<br />            Connection connection = DriverManager.getConnection(url, DB_USER, DB_USER);<br />            connection.close();<br />            databaseExists = true;<br />        } catch (SQLException ignore) {<br />        }<br />        return databaseExists;<br />    }<br /><br />    public void createDatabase() throws SQLException {<br />        Connection conn = ds.getConnection();<br /><br />        Statement statementDrop = conn.createStatement();<br />        statementDrop.executeUpdate("DROP TABLE IF EXISTS LOG");<br /><br />        Statement statement = conn.createStatement();<br />        statement.executeUpdate("CREATE TABLE LOG (" +<br />                "HEURE TIMESTAMP," +<br />                "TYPE_LOG VARCHAR(10)," +<br />                "MESSAGE VARCHAR(500))");<br /><br />        statementDrop = conn.createStatement();<br />        statementDrop.executeUpdate("DROP TABLE IF EXISTS ENONCE");<br /><br />        statement = conn.createStatement();<br />        statement.executeUpdate("CREATE TABLE ENONCE (" +<br />                "ID INTEGER," +<br />                "TITLE VARCHAR(100)," +<br />                "ENONCE VARCHAR(4000))");<br /><br />        conn.close();<br />    }<br /><br />    private LogDao logDao;<br /><br />    public LogDao getLogDao() {<br />        if (logDao == null) {<br />            logDao = new LogDao(ds);<br />        }<br />        return logDao;<br />    }<br /><br />    private EnonceDao enonceDao;<br /><br />    public EnonceDao getEnonceDao() {<br />        if (enonceDao == null) {<br />            enonceDao = new EnonceDao(ds);<br />        }<br />        return enonceDao;<br />    }<br />}<br /></pre></p><p>Le but était de vous montrer que pour faire des trucs simples, il n'est pas toujours utile de sortir l'artillerie lourde avec du JPA ou autre... </p> <h2>Et pour les tests unitaires?</h2><p>Comme vous avez pu voir, les tests unitaires ne sont pas vraiment unitaire puisqu'ils testent l'application de bout en bout. Se pose du coup la question de la base de donnée qui ralentie les tests de manière inutile, heureusement h2 possède un mode mémoire qui rend la base très rapide et non persistante après les tests (ce qui permet de repartir à zéro à chaque fois). Pour passer d'un mode à l'autre, rien de sorcier : <pre class="brush:java">public static String getUrl() {<br />    if (test) {<br />        return "jdbc:h2:mem:codestory;DB_CLOSE_DELAY=-1";<br />    }<br />    return "jdbc:h2:./codestory";<br />}<br /></pre>Il ne faut pas oublier le "DB_CLOSE_DELAY=-1" qui permet de garder la base soit active tant que la jvm existe (ça évite d'avoir des problèmes de structures qui disparaissent d'un test à l'autre).</p><br /><br /><br /><p>À bientôt pour Scalaskel et la Calculette, puis pour le plus interessant : Jajascript et les performances.</p>
</p>
                <p><a href="2013/02/ma-participation-codestory-en-java-intro.html#disqus_thread">Commentaires</a></p>
            

        

    </div>

    <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
        <div class="sidebar-module sidebar-module-inset">
            <h4>Yan Bonnel</h4>
            <p>Geek. Technos de prédilections : Java, Android, Git.</p>
        </div>


        <div class="sidebar-module">
            <h4>Tags</h4>
            <ol class="list-unstyled" style="margin-left: 0px">
                

                <li><a href="Java.html">Java</a> (15)</li>
                

                <li><a href="java8.html">java8</a> (6)</li>
                

                <li><a href="SimpleWeb4j.html">SimpleWeb4j</a> (6)</li>
                

                <li><a href="CodeStory.html">CodeStory</a> (5)</li>
                

                <li><a href="Devoxx.html">Devoxx</a> (5)</li>
                

                <li><a href="EventSource.html">EventSource</a> (4)</li>
                

                <li><a href="Server-Sent-Events.html">Server-Sent-Events</a> (4)</li>
                

                <li><a href="SSE.html">SSE</a> (4)</li>
                

                <li><a href="CSV.html">CSV</a> (3)</li>
                

                <li><a href="Jetty.html">Jetty</a> (3)</li>
                

                <li><a href="simple.html">simple</a> (3)</li>
                

                <li><a href="Android.html">Android</a> (2)</li>
                

                <li><a href="blogger.html">blogger</a> (2)</li>
                

                <li><a href="github.html">github</a> (2)</li>
                

                <li><a href="javascript.html">javascript</a> (2)</li>
                

                <li><a href="jbake.html">jbake</a> (2)</li>
                

                <li><a href="Logo.html">Logo</a> (2)</li>
                

                <li><a href="Rennes.html">Rennes</a> (2)</li>
                

                <li><a href="TDD.html">TDD</a> (2)</li>
                

                <li><a href="websocket.html">websocket</a> (2)</li>
                

                <li><a href="Assertj.html">Assertj</a> (1)</li>
                

                <li><a href="auto-hébergement.html">auto-hébergement</a> (1)</li>
                

                <li><a href="Awaitility.html">Awaitility</a> (1)</li>
                

                <li><a href="cloud.html">cloud</a> (1)</li>
                

                <li><a href="Comparatif.html">Comparatif</a> (1)</li>
                

                <li><a href="couchbase.html">couchbase</a> (1)</li>
                

                <li><a href="CsvEngine.html">CsvEngine</a> (1)</li>
                

                <li><a href="ExecutorService.html">ExecutorService</a> (1)</li>
                

                <li><a href="git.html">git</a> (1)</li>
                

                <li><a href="Google.html">Google</a> (1)</li>
                

                <li><a href="Groovy.html">Groovy</a> (1)</li>
                

                <li><a href="Jajascript.html">Jajascript</a> (1)</li>
                

                <li><a href="JEE.html">JEE</a> (1)</li>
                

                <li><a href="json.html">json</a> (1)</li>
                

                <li><a href="NoMock.html">NoMock</a> (1)</li>
                

                <li><a href="OneDay.html">OneDay</a> (1)</li>
                

                <li><a href="OnePost.html">OnePost</a> (1)</li>
                

                <li><a href="reactive.html">reactive</a> (1)</li>
                

                <li><a href="REST.html">REST</a> (1)</li>
                

                <li><a href="Scalaskel.html">Scalaskel</a> (1)</li>
                
            </ol>
        </div>
    </div>

    </div>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="text-muted credit">L'ensemble des posts de ce blog sont publiés sous licence <em>Creative Commons by-nc-sa</em>. <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a></p>
        <p class="text-muted credit">&copy; 2013 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v3.0.2</a> | Baked with <a href="http://jbake.org">JBake v2.3.0</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- script src="/js/jquery-1.10.2.min.js"></script -->
    <!-- script src="/js/bootstrap.min.js"></script -->
    <script src="../js/run_prettify.js"></script>

    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shCore.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushCss.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushJava.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushJScript.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushSql.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushVb.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushXml.js' type='text/javascript'></script>
    <script src='http://alexgorbatchev.com/pub/sh/3.0.83/scripts/shBrushBash.js' type='text/javascript'></script>


    <script language='javascript'>
        SyntaxHighlighter.config.bloggerMode = true;
        SyntaxHighlighter.all();
    </script>


    <script type="text/javascript">
        window.___gcfg = {lang: 'fr'};

        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-28563381-1', 'www.ybonnel.fr');
      ga('send', 'pageview');

    </script>
    
  </body>
</html>

